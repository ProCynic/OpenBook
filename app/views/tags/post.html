
  <!--
  <span id = "numLikesPost${_item.id}">
    ${_item.likes.size()} Like#{if _item.likes.size() != 1}s#{/if} 
  </span> 
  #{if _user.isFriendsWith(_currentUser) || _user==_currentUser} 
    <a class=button id = "likeButton${_item.id}" href = '#' onclick="return false;">*{Text here is generated by drawLikesButton_xx}*</a>
    
    . ${_item.comments.size()} Comment#{if _item.comments.size() != 1}s#{/if}
    . 
    #{timeago date:_item.updatedAt /}
    #{if _item.author ==  _currentUser} 
      . <a id="deletePostSubmit${_item.id}" onclick="return false;" href="#">delete my post</a> 
    #{/if}
  #{/if}   
-->

<ul class="unstyled individual-post well">
  <li class="row-fluid vertical-element">
    <a href="/users/${_item.author.id}">
      <img style="width: 50px; height: 50px;"
           src="@{Photos.getPhoto(_item.author.profile.profilePhoto)}" alt="${_item.author.name}"/>
      ${_item.author.name}
    </a>
  </li>

  <li class="row-fluid vertical-element">
    <article>
      #{if _item.getClass().getName() == "models.Photo"}
        <div class="post-image thumbnail">
          <img src="@{Photos.getPhoto(_item.id)}" />
        </div>
      #{/if}
    
      #{elseif _item.getClass().getName() == "models.Link"}
        <div class="post-link">
          <iframe src="${((models.Link)_item).external_url}"></iframe>
        </div>
      #{/elseif}
      #{else}
        ${_item.content.nl2br()}
      #{/else}
    </article>
  </li>

  <hr>

  <li class="row-fluid vertical-element">
    <div class="span2">
      <strong>${_item.comments.size()} Comment#{if _item.comments.size() != 1}s#{/if}</strong>
    </div>
    <div class="span2">
      <strong>${_item.likes.size()} Like#{if _item.likes.size() != 1}s#{/if}</strong>
    </div>
    <div class="span2">
      <button class="btn btn-mini btn-success"><i class="icon-ok"></i> Like!</button>
    </div>
    <div class="span6"></div>
  </li>

  <li class="row-fluid vertical-element">
    <div class="span4">
      Posted at: ${_item.createdAt}
    </div>
    <div class="span2">
      #{if _item.author ==  _currentUser} 
        <button class="btn btn-mini btn-danger" id="deletePostSubmit${_item.id}" onclick="return false;">delete my post</button> 
      #{/if}
    </div>
    <div class="span6"></div>
  </li>
  
  <hr>

  <li class="row-fluid vertical-element">
    <ul class="comment-list unstyled">
      #{list items:_item.getComments(), as:'comment'} 
        <li>#{comment user:_user, currentUser:_currentUser, comment:comment /}</li>
      #{/list}
    </ul>
  </li>


  <li class="row-fluid vertical-element" id="new_comment_for_post${_item.id}">
    <div class="span4">
      <textarea name="comment_content${_item.id}" id="commentContent${_item.id}" style="width:100%;"></textarea>
    </div>
    <div class="span2">
      <button class="btn" id="commentSubmit${_item.id}"><i class="icon-plus"></i> Comment</button>
    </div>
    <div class="span6"></div>
  </li>
</ul>


<script type="text/javascript">
  var hasTypedComment${_item.id} = new Boolean();
  var defaultComment = "new comment...";
  $('#commentContent${_item.id}').keydown(function(){
  hasTypedComment${_item.id} = true;
  if(this.val==''){
  hasTypedComment${_item.id} = false;
  }
  });
  
  $('a#commentSubmit${_item.id}').click(function(event) {
  if(hasTypedComment${_item.id}==true){
  var commentData = {
  commentContent : $("textarea#commentContent${_item.id}").val(),
  statusId : ${_item.id},
  userId : ${_user.id},
  };
  
  $.post("/comments/makeNewComment", commentData, function(data) {
  var new_item = $(data).hide();
  $("div#newComments${_item.id}").append(new_item);
  new_item.slideDown();
  hasTypedComment${_item.id} = false;
  $('#commentContent${_item.id}').val(defaultComment);
  });
  }
  });
</script>
<script type="text/javascript">
  $('a#deletePostSubmit${_item.id}').click(function(event) {
  var deleteData = {
  postId : ${_item.id}
  };
  
  $.post("/posts/deletepost", deleteData, function() {
  $('div#post${_item.id}').slideUp();
  });
  });
</script>

<script>
  $('#commentContent${_item.id}').val(defaultComment);
  $('#commentContent${_item.id}')
  .focusin(function() {
  if ( this.value == defaultComment ) {
  this.value = '';    
  }
  })
  .focusout(function() {
  if ( this.value == '' ) {
  hasTypedComment${_item.id} = false;
  this.value = defaultComment;    
  }
  });
</script>

<script >
  var likes_${_item.id} = ${_item.currentUserLiked()};
  
  function drawLikesButton_${_item.id}( elem ) {
  if( !likes_${_item.id} ) {
  elem.text('Like');
  } else {
  elem.text('Unlike');
  }
  }
  
  drawLikesButton_${_item.id}( $('#likeButton${_item.id}') );
  
  $('#likeButton${_item.id}').click(function(){
  var postData = {
  likeableId  : ${_item.id}, 
  };
  
  var bttn = $(this);
  
  if( !likes_${_item.id} ) {
  $.post("/Application/addLikeAjax", postData, function(data) {
  $("span#numLikesPost"+data.likeableID).text(data.numLikes+ " Like"+(data.numLikes == 1? "" : "s"));
  likes_${_item.id} = !likes_${_item.id};
  drawLikesButton_${_item.id}(bttn);
  });
  } else {
  $.post("/Application/removeLikeAjax", postData, function(data) {
  $("span#numLikesPost"+data.likeableID).text(data.numLikes+ " Like"+(data.numLikes == 1? "" : "s"));
  likes_${_item.id} = !likes_${_item.id};
  drawLikesButton_${_item.id}(bttn);
  });
  }
  
  });
  
</script>
