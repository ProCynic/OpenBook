#{extends 'two-panel.html' /}
<link rel="stylesheet" type="text/css" media="screen"
      href="/public/stylesheets/news.css" />
<h1>${user.name}</h1> 
#{if user.checkFriendship(user.id) == 'Request Friendship'}
  <a id="friend-button" href="@{Application.requestFriends(user.id)}">
    ${user.checkFriendship(user.id)}
  </a>
#{/if}
#{elseif user.checkFriendship(user.id) == 'Friendship Requested'}
  Friendship Requested
#{/elseif}
#{elseif user.checkFriendship(user.id) == 'Friends'}
  Friends :) 
  <a id="friend-button" href="@{Application.removeFriends(user.id)}">
    Remove friend
  </a>
#{/elseif}

<h3>Blog Posts</h3>
<ul class="post-list">
  #{list items:user.news(), as:'item'}
    <li>
      <div class="post">
        <span class="post-author"><a href="@{Application.news(item.author.id)}">${ item.author.name }</a></span>,
        <span class="post-date">${item.date.format('dd MMM yy')}</span>
        <article class="post-content">
          ${item.content.nl2br()}
        </article>
        <ul class="comment-list">
        #{list items:item.comments(), as:'comment'}
            <li class="comment">
              <div class="comment-metadata">
                <span class="comment-author">by ${comment.author},</span>
                <span class="comment-date">
                  ${comment.date.format('dd MMM yy')}
                  <a class=button href="@{Comments.deleteComment(comment.id,user.id)}">delete</a>
                </span>
                <div class="comment-content">
                  ${comment.content.escape().nl2br()}
                </div>
            </li>
          #{/list}
        </ul>
        #{form @Comments.postComment(item.id, user.id)}
          <textarea name="content" id="content"></textarea>
          <input type="submit" value="Comment" />
        #{/form}
      </div>
    </li>
  #{/list}
</ul>
