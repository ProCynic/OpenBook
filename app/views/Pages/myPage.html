#{extends 'main.html' /} 
#{extends 'three_panel.html' /} 
<div id="contentArea">
#{if page.admin == _user}
<h1>${page.title}</h1>
	<div id="pageInfo${page.id}">${page.info}</div> <br>
	<script type="text/JavaScript" src="util.js"></script> 
	<div class="hideable">
		<a class="triggershow showfirst" href='#' onclick='return false;'>+edit</a>
		<a class="triggerhide" href='#' onclick='return false;'>-done</a>
		<div class="post-teaser tohideopp"></div>
			<div class="post-content tohide hide">
			Admin: ${page.admin} <a href="@{Pages.deletePage(page.id)}"
				style="float: right">Delete this Page</a> <br>Info:<br>
				#{if page.info != null}
					<textarea name="post_content" id="pageInfo" class="ui_TextBox" rows="2" cols="45" maxlength="400">${page.info}</textarea>
					<input type="submit" value="Save" id="pageUpdate" class="button" style="float:right"/>
				#{/if}
				#{else}
					<textarea name="post_content" id="pageInfo$" class="ui_TextBox" rows="2" cols="45" maxlength="400">write something about the page</textarea>
					<input type="submit" value="Save" id="pageUpdate" class="button" style="float:right"/>
				#{/else}
			</div>
		</div>
	</div>
#{/if} 
#{elseif page != null}
	<h1>${page.title}</h1>
	<div id="pageInfo${page.id}" style="float: left">${page.info}</div>
		<div style="float: right">
			<a class=button id = "fan${page.id}" href='#' onclick="return false;">*{text}*</a>
		</div>
		<hr style="float: left; width: 100%; color: #98AFC7;" />
	</div>
#{/elseif}		       
#{include 'Pages/post.html' /}
</div>

<script>
var fan_${page.id} = ${fan};

function drawFanButton_${page.id}( elem ) {
  if( !fan_${page.id} ) {
    elem.text('Fan');
  } else {
    elem.text('UnFan');
  }
}

drawFanButton_${page.id}( $('#fan${page.id}') );

$('#fan${page.id}').click(function(){
  var postData = {pid  : ${page.id}};
  var bttn = $(this);
  if( !fan_${page.id} ) {
    $.post("/Pages/fan", postData, function(data) {
      fan_${page.id} = !fan_${page.id};
      drawFanButton_${page.id}(bttn);
    });
  }
  else{
    $.post("/Pages/fan", postData, function(data) {
      fan_${page.id} = !fan_${page.id};
      drawFanButton_${page.id}(bttn);
    });
  }

});

$('input#pageUpdate').click(function(event) {
  var postData = {
  info : $("textarea#pageInfo${page.id}").val(),
  pid : ${page.id}
  };
  var pUpdate = #{jsAction @Pages.pageUpdate(':pid',':info') /};
   $.post(pUpdate, postData, function(data) {
   		 $('#pageInfo${page.id}').html(data);
   };
  });
</script>
