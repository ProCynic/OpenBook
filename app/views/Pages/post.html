		<div class="ui_InputContainer" id="PostContainer"><textarea name="post_content" id="postContent" class="ui_TextArea" rows="2" cols="45" maxlength="400" >new post...</textarea>
    <input type="submit" value="Post" id="postSubmit" class="ui_TextAreaButton" />    
   </div>
	
	<div id="contentArea">
   <script type="text/JavaScript" src="page.js"></script>
		#{list items:page.getPosts(), as:'_item'}
		
		<div class="post">
	<div class="hideable">
		<div class="left">
			<img style="width: 50px; height: 50px;"
				src="@{Photos.getPhoto(_item.author.profile.profilePhoto)}" />
		</div>
  <div class="individual-post">
      <div class="post-author" style="clear: both;">
        <a href="@{Application.news(_item.author.id)}">${_item.author.name}</a>
      </div>
      #{if _item.comments.size() > 2}
        <a class='triggershow showfirst' href='#' onclick='return false;'> +${_item.comments.size() - 2} more comment#{if _item.comments.size()-2 != 1}s#{/if}</a>
        <a class='triggerhide' href='#' onclick='return false;'> -hide comment#{if _item.comments.size() != 1}s#{/if}</a>
      #{/if}
      
			<div class="post-content">
			#{if _item.getClass().getName() == "models.Photo"}
			  <div class="post-image"><img src="@{Photos.getPhoto(_item.id)}" /></div>
			#{/if}
			#{if _item.getClass().getName() == "models.Link"}
			  <div class="post-link">
			    <iframe src="${((models.Link)_item).external_url}"></iframe>
			  </div>
			#{/if}
			${_item.content.nl2br()}
			
			</div>
        <div class="commentsList">
                #{list items:_item.getSomeComments(), as:'comment'} 
                    #{comment user:user,currentUser:_currentUser,comment:comment /} 
                  #{/list}
        </div>
     </div>
		 <div class="tohide hide" style="clear: both; display: none;">
				<div class="commentsList">
				  #{list items:_item.getComments(), as:'comment'} 
				    #{comment user:user,currentUser:_currentUser,comment:comment /} 
				  #{/list}
				</div>
			</div>
            <div id="newComments${_item.id}"></div> 
				<div id="new_comment_for_post${_item.id}" style="clear: both;" >
					<img style="width: 30px; height: 30px;"	src=@{Photos.getPhoto(user.profile.profilePhoto)} display="inline" /> 
					
					   <textarea name="comment_content${_item.id}" id="commentContent${_item.id}" style="color:grey;" resize="none" rows="2" cols="35" maxlength="400" >new comment...</textarea>
                       <input type="submit" value="Comment" id="commentSubmit${_item.id}" /> 
				</div>


    </div>
  </div>
</div>

		#{/list}
	</div>
	
	
<script>

   $('input#commentSubmit${_item.id}').click(function(event) {
       var commentData = {
             commentContent : $("textarea#commentContent${_item.id}").val(),
             statusId : ${_item.id},
             userId : ${user.id},
         };
       
         $.post("/comments/makeNewComment", commentData, function(data) {
         var new_item = $(data).hide();
           $("div#newComments${_item.id}").append(new_item);
          new_item.slideDown();
           $("textarea#commentContent${_item.id}").val('');
         });
   });

  $('#commentContent${_item.id}')
  .focusin(function() {
  if ( this.value == 'new comment...' ) {
  this.value = '';    
  }
  })
  .focusout(function() {
  if ( this.value == '' ) {
  this.value = 'new comment...';    
  }
  });

var likes_${_item.id} = ${_item.currentUserLiked()};

function drawLikesButton_${_item.id}( elem ) {
  if( !likes_${_item.id} ) {
    elem.text('Like');
  } else {
    elem.text('Unlike');
  }
}

drawLikesButton_${_item.id}( $('#likeButton${_item.id}') );

$('#likeButton${_item.id}').click(function(){
  var postData = {
     likeableId  : ${_item.id}, 
  };
  
  var bttn = $(this);

  if( !likes_${_item.id} ) {
    $.post("/Application/addLikeAjax", postData, function(data) {
      $("span#numLikesPost"+data.likeableID).text(data.numLikes+ " Like"+(data.numLikes == 1? "" : "s"));
      likes_${_item.id} = !likes_${_item.id};
      drawLikesButton_${_item.id}(bttn);
    });
  } else {
    $.post("/Application/removeLikeAjax", postData, function(data) {
      $("span#numLikesPost"+data.likeableID).text(data.numLikes+ " Like"+(data.numLikes == 1? "" : "s"));
      likes_${_item.id} = !likes_${_item.id};
      drawLikesButton_${_item.id}(bttn);
    });
  }

});

  $('input#postSubmit').click(function(event) {
  		var postAction = #{jsAction @Pages.post(':pid', ':pContent') /}
  var postData = { postContent : $("textarea#postContent").val(),};
  //$.load(postAction({pid: ${page.id}, pContent: $("textarea#postContent").val()}), function(data) {
  $.post("/pages/post", postData, function(data) {
  		alert("crap");
  var new_item = $(data).hide();
  $("div#postsList").prepend(new_item);
  new_item.slideDown();
  $("textarea#postContent").val('');
  });
  });

  /*Show before resizing, with jQuery to avoid glitchy redisplay*/
  $('textarea#postContent').css('display','inline-block');
  $('input#postSubmit').css('display', 'inline-block');

  /*autoResize*/
  $('textarea#postContent').autoResize({
  maxHeight: 150,
  minHeight: 50,
  extraSpace: 30
  });
  
  /*autoResize*/
  $('textarea#commentContent').autoResize({
  maxHeight: 70,
  minHeight: 20,
  extraSpace: 20
  }); 
  
  $('#postContent')
  .focusin(function() {
  if ( this.value == 'new post...' ) {
  this.value = '';    
  }
  })
  .focusout(function() {
  if ( this.value == '' ) {
  this.value = 'new post...';    
  }
  });
</script>
